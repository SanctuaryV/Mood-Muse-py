import google.generativeai as genai

def initialize_gemini(api_key):
    genai.configure(api_key=api_key)
    return genai.GenerativeModel("gemini-2.0-flash")

def get_gemini_suggestions(emotion_type, text, api_key):
    model = initialize_gemini(api_key)

    # สร้าง prompt ตามประเภทอารมณ์
    if "negative" in emotion_type:
        prompt = f"""
        ฉันรู้สึกไม่ดีและเขียนข้อความนี้: "{text}"

        วิเคราะห์ว่าข้อความนี้แสดงถึงอารมณ์ใดเป็นพิเศษ (เช่น เศร้า โกรธ เหนื่อย กังวล เหงา หรืออื่นๆ)
        จากนั้นให้คำแนะนำที่เป็นประโยชน์และเฉพาะเจาะจงกับอารมณ์นั้น 3-4 ข้อ
        คำแนะนำควรเป็นภาษาไทย กระชับ และปฏิบัติได้จริง
        ตอบในรูปแบบข้อความที่มีจุดนำหน้าแต่ละคำแนะนำ
        """
    elif "positive" in emotion_type:
        prompt = f"""
        ฉันรู้สึกดีและเขียนข้อความนี้: "{text}"

        วิเคราะห์ว่าข้อความนี้แสดงถึงอารมณ์ใดเป็นพิเศษ (เช่น มีความสุข สงบ พึงพอใจ ตื่นเต้น หรืออื่นๆ)
        จากนั้นให้คำแนะนำที่เป็นประโยชน์เพื่อรักษาหรือต่อยอดความรู้สึกดีนั้น 3-4 ข้อ
        คำแนะนำควรเป็นภาษาไทย กระชับ และปฏิบัติได้จริง
        ตอบในรูปแบบข้อความที่มีจุดนำหน้าแต่ละคำแนะนำ
        """
    else:  # เป็นกลาง
        prompt = f"""
        ฉันรู้สึกเป็นกลางและเขียนข้อความนี้: "{text}"

        วิเคราะห์ความรู้สึกที่อาจซ่อนอยู่ในข้อความนี้
        จากนั้นให้คำแนะนำที่เป็นประโยชน์เพื่อเสริมสร้างความรู้สึกเชิงบวก 3-4 ข้อ
        คำแนะนำควรเป็นภาษาไทย กระชับ และเฉพาะเจาะจงกับเนื้อหาข้อความ
        ตอบในรูปแบบข้อความที่มีจุดนำหน้าแต่ละคำแนะนำ
        """

    response = model.generate_content(prompt)
    return response.text.strip() if hasattr(response, 'text') else "ไม่สามารถตอบกลับจาก Gemini ได้"
